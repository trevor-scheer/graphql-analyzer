# Knope configuration for graphql-lsp workspace
# https://knope.tech

# Single package for the entire workspace - all crates share the same version
[package]
versioned_files = ["Cargo.toml", "editors/vscode/package.json"]
changelog = "CHANGELOG.md"

# Conventional commit scopes that map to this package
# Changes with these scopes affect this package's version
[package.scopes]
"*" = "graphql-lsp"

# GitHub integration for PR creation and releases
[github]
owner = "trevor-scheer"
repo = "graphql-analyzer"

[workflows]

# Prepare a release PR - consumes changesets and creates a PR with version bump
# Currently in alpha phase. To release stable versions, remove prerelease_label.
[workflows.prepare-release]
[[workflows.prepare-release.steps]]
type = "PrepareRelease"
prerelease_label = "alpha"

[[workflows.prepare-release.steps]]
type = "Command"
command = "cargo check --workspace"

# Create a PR with the changes (requires GITHUB_TOKEN)
[[workflows.prepare-release.steps]]
type = "CreatePullRequest"
base = "main"

[workflows.prepare-release.steps.title]
template = "chore: prepare release v{{version}}"
variables = { "version" = "Version" }

[workflows.prepare-release.steps.body]
template = """
## Release

This PR was auto-generated by [knope](https://knope.tech) to prepare a new release.

### Changelog

{{changelog}}

---

When merged, this will trigger the release workflow to:
1. Create git tag `v{{version}}`
2. Build release artifacts (binaries + VSCode extension)
3. Create GitHub release
"""
variables = { "version" = "Version", "changelog" = "ChangelogEntry" }

# Execute the release - creates git tag and pushes it
[workflows.release]
[[workflows.release.steps]]
type = "Release"
